version: "3"
services:
  flink:
    image: ${FLINK_IMAGE}
    command: ha-cluster
    hostname: flinkjobmanger
    environment:
      - |
        FLINK_PROPERTIES=
        classloader.resolve-order: parent-first
        rest.flamegraph.enabled: true
      - _FLINK_RUN_JOB=/opt/flink/todo-app.jar --config /opt/flink/todo-app.yaml --scale 1
    ports:
      - "8181:8081"
    volumes:
      - todo-app:/usr/share/zookeeper
      - todo-app:/usr/share/flink
      - ../target/todo-app.jar:/opt/flink/todo-app.jar
      - ./todo-app.yaml:/opt/flink/todo-app.yaml
    networks:
      - dev
volumes:
  todo-app:
    driver: local

networks:
  dev:
    external:
      name: ${TODO_APP_NETWORK:-todo-app}